# 性能调优

## linux相关

### top

> top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器

**命令格式**

top [参数]

**功能**

显示当前系统正在执行的进程的相关信息，包括进程ID、内存占用率、CPU占用率等

**命令参数**

-b 批处理

-c 显示完整的治命令

-I 忽略失效过程

-s 保密模式

-S 累积模式

-i<时间> 设置间隔时间

-u<用户名> 指定用户名

-p<进程号> 指定进程

-n<次数> 循环显示的次数



### df

> Linux df（英文全拼：disk free） 命令用于显示目前在 Linux 系统上的文件系统磁盘使用情况统计。

**语法**

```
df [选项]... [FILE]...
```

- 文件-a, --all 包含所有的具有 0 Blocks 的文件系统
- 文件--block-size={SIZE} 使用 {SIZE} 大小的 Blocks
- 文件-h, --human-readable 使用人类可读的格式(预设值是不加这个选项的...)
- 文件-H, --si 很像 -h, 但是用 1000 为单位而不是用 1024
- 文件-i, --inodes 列出 inode 资讯，不列出已使用 block
- 文件-k, --kilobytes 就像是 --block-size=1024
- 文件-l, --local 限制列出的文件结构
- 文件-m, --megabytes 就像 --block-size=1048576
- 文件--no-sync 取得资讯前不 sync (预设值)
- 文件-P, --portability 使用 POSIX 输出格式
- 文件--sync 在取得资讯前 sync
- 文件-t, --type=TYPE 限制列出文件系统的 TYPE
- 文件-T, --print-type 显示文件系统的形式
- 文件-x, --exclude-type=TYPE 限制列出文件系统不要显示 TYPE
- 文件-v (忽略)
- 文件--help 显示这个帮手并且离开
- 文件--version 输出版本资讯并且离开



### 查看物理内存占用

```sh
free -mh
```

total——总物理内存

used——已使用内存

free——完全未被使用的内存

shared——应用程序共享内存

buffers——缓存，主要用于目录方面,inode值等（ls大目录可看到这个值增加）

cached——缓存，用于已打开的文件

-buffers/cache=used-buffers-cached

+buffers/cache=free+buffers+cached



### 清除缓存

1.数据同步

```sh
sync
```

2.删除缓存数据

```sh
echo 3 >/proc/sys/vm/drop_caches
```



echo 0 是不释放缓存

echo 1 是释放页缓存

ehco 2 是释放dentries和inodes缓存

echo 3 是释放 1 和 2 中说道的的所有缓存



### netstat

> Netstat是控制台命令,是一个监控TCP/IP网络的非常有用的工具，它可以显示路由表、实际的网络连接以及每一个网络接口设备的状态信息

#### 查看time_wait,establish等状态

```shell
netstat -ant |awk 'NR>2{print $6}'|sort|uniq -c|sort -rn 
```

查看TIME_WAIT数量

```shell
netstat -an |grep "TIME_WAIT" |wc -l
```







## java相关

### jps

jps -l

jps -lv

### jstat

jstat -gc [进程id] [interval] [count]

### jmap

jmap -heap [进程id]





## nginx相关

### nginx的目录

```sh
/usr/local/nginx
```





## tomcat相关

maxThreads、minSpareThreads是tomcat工作线程池的配置参数，maxThreads就相当于jdk线程池的maxPoolSize，而minSpareThreads就相当于jdk线程池的corePoolSize

    accept-count: 1000
    # 最大连接
    max-connections: 8192
    # 连接超时时间
    connection-timeout: 10000